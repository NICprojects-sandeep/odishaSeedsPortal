/// excel data fetch in  odishaagrilicense


https://odishaagrilicense.nic.in/exportSeedLic

https://odishaagrilicense.nic.in/exportSeedUser

https://odishaagrilicense.nic.in/exportSeedProducer




///value inserted in seed database

DECLARE @REF_NO VARCHAR(50);
DECLARE @LIC_NO VARCHAR(50);
DECLARE @mAPP_DATE DATE; 
DECLARE @mYR INT;
DECLARE @mMON INT;
DECLARE @YR INT;
DECLARE @DAO_CD INT;
DECLARE @mDIST_NAME CHAR(3);
DECLARE @FINYR VARCHAR(10); 
DECLARE @mDAO_CD VARCHAR(4);
DECLARE @NO INT;
DECLARE @mNO VARCHAR(4);
DECLARE @DEALER_CODE VARCHAR(50);
DECLARE @DIST_CODE CHAR(2);
DECLARE @DEALER_CODENO INT;
DECLARE @APP_TYPE VARCHAR(50);
DECLARE @APP_SHORTTYPE CHAR(1);

DECLARE @SLNO VARCHAR(50);
DECLARE @APP_FIRMNAME VARCHAR(50); 

DECLARE @APR_UPTO VARCHAR(50); 

DECLARE @APPMOB_NO VARCHAR(50); 
DECLARE @AADHAR_NO VARCHAR(50); 
DECLARE @userId VARCHAR(50); 
DECLARE @SALTED_PASSWORD VARCHAR(max); 

DECLARE @DIST_NAME VARCHAR(50); 
declare @aDAO_CD varchar(50);
DECLARE @DAO_NAME VARCHAR(50); 
DECLARE @APR_DATE VARCHAR(50); 
DECLARE @PHOTO VARCHAR(50); 
DECLARE @REFNO1 VARCHAR(50); 
DECLARE @LICNO1  VARCHAR(50);
DECLARE @LIC_TYPE VARCHAR(50);

DECLARE @SEED_LIC_DIST_ID VARCHAR(50);
DECLARE @APPNAME VARCHAR(50); 
DECLARE @APPADDRESS VARCHAR(50); 
DECLARE @APPSTATE VARCHAR(50); 
DECLARE @APPDIST_ID VARCHAR(50); 
DECLARE @APPBLOCK_ID VARCHAR(50); 
DECLARE @APPPIN VARCHAR(50); 
DECLARE @APPEMAIL_ID VARCHAR(50); 
DECLARE @APPICARD_TYPE VARCHAR(50); 
DECLARE @APPCARD_NO VARCHAR(50);

DECLARE @COMP_NAME VARCHAR(MAX);
DECLARE @COMP_TYPE INT;
DECLARE @CNT INT;

DECLARE cur CURSOR FOR     
SELECT SLNO, APP_FIRMNAME, APP_TYPE, APR_UPTO, LIC_NO, APPMOB_NO, AADHAR_NO, userId, SALTED_PASSWORD, DIST_CODE, DIST_NAME, DAO_CD, DAO_NAME, APR_DATE, PHOTO,LIC_TYPE, REFNO1, LICNO1 FROM SEEDLICDIST WHERE SLNO=9439 --lic_type = 'FALSE' AND REFNO1 IS NULL 
  
OPEN cur    
  
FETCH NEXT FROM cur     
INTO @SLNO, @APP_FIRMNAME, @APP_TYPE, @APR_UPTO, @LIC_NO, @APPMOB_NO, @AADHAR_NO, @userId, @SALTED_PASSWORD, @DIST_CODE, @DIST_NAME, @aDAO_CD, @DAO_NAME, @APR_DATE, @PHOTO,@LIC_TYPE, @REFNO1, @LICNO1    
  
WHILE @@FETCH_STATUS = 0    
BEGIN    

IF(@LIC_TYPE = 'TRUE')
BEGIN
UPDATE SEED_LIC_DIST SET APR_UPTO = @APR_UPTO WHERE LIC_NO = @LICNO1
END
ELSE
BEGIN

SET @CNT = (SELECT COUNT(*) FROM SEED_LIC_DIST WHERE LIC_NO1 = @LIC_NO)
IF(@CNT = 0)
BEGIN
SELECT @DIST_CODE = DDA_CODE,@mDIST_NAME = DDA_NAME,@DAO_CD = DAO_CODE FROM FMN_DDA_DAO_LIST WHERE DAO_CD = @aDAO_CD                      

SET @mAPP_DATE = CURRENT_TIMESTAMP; 
SET @mYR = (SELECT DATEPART(yy, @mAPP_DATE)); 
SET @mMON = (SELECT DATEPART(MM, @mAPP_DATE)); 
                                
IF(@mMON>=1 AND @mMON<=3) 
SET @YR = @mYR-1; 
ELSE 
SET @YR = @mYR; 

SET @mDAO_CD = (@mDIST_NAME + RIGHT(CONVERT(VARCHAR,@DAO_CD),1))                            
SET @FINYR = CONVERT(VARCHAR(10), @YR)+'-'+SUBSTRING(CONVERT(VARCHAR(10), @YR+1),3,2)                                
                                
SET @NO = (SELECT ISNULL(MAX((SUBSTRING(REF_NO,16,4))),0)+1 FROM SEED_LIC_DIST WHERE SUBSTRING(REF_NO,3,4) = @mDAO_CD AND SUBSTRING(REF_NO,8,7) = @FINYR)         
                                
SET @mNO = RIGHT('0000' + CONVERT(VARCHAR,@NO), 4);                                
SET @REF_NO='OD'+ @mDAO_CD +'/'+ @FINYR +'/'+ @mNO +'/N'

SET @NO = (SELECT ISNULL(MAX((SUBSTRING(LIC_NO,16,4))),0)+1 FROM SEED_LIC_DIST  WHERE SUBSTRING(LIC_NO,3,4) = @mDAO_CD AND SUBSTRING(LIC_NO,8,7) = @FINYR)
SET @mNO = RIGHT('0000' + CONVERT(VARCHAR,@NO), 4); 
SET @LICNO1='OD'+ @mDAO_CD +'/'+ @FINYR +'/'+ @mNO ;

IF(@APP_TYPE = 'Secretary PACS')
BEGIN
SET @APP_SHORTTYPE = 'P';
END
ELSE
BEGIN
SET @APP_SHORTTYPE = 'D';
END

SET @DEALER_CODENO = (SELECT MAX(CONVERT(INT,ISNULL(SUBSTRING(DEALER_CODE,7,10),0)))+1 FROM SEED_LIC_DIST WHERE DIST_CODE = @DIST_CODE)

SET @DEALER_CODE = @mDIST_NAME+'/'+CONVERT(VARCHAR(10),@APP_SHORTTYPE)+'/'+CONVERT(VARCHAR(10),@DEALER_CODENO)

INSERT INTO SEED_LIC_DIST            
(          
REF_NO,          
NAUTHORITY,            
DIST_CODE,            
DAO_CD,            
BUSS_TYPE,            
APP_DATE,            
APP_FIRMNAME,  
APP_TYPE,
APR_DATE,
APR_UPTO,
APPMOB_NO,
APP_STATUS,
AADHAAR_NO,  
PASSWORD, 
SALTED_PASSWORD,
DEALER_CODE,
LIC_NO,
LIC_NO1           
)            
VALUES            
(          
@REF_NO,          
'District Agriculture Officer',            
@DIST_CODE,            
@DAO_CD,            
'Dealer',            
CURRENT_TIMESTAMP,    
@APP_FIRMNAME,  
@APP_TYPE,
@APR_DATE, 
@APR_UPTO, 
@APPMOB_NO,
'A', 
@AADHAR_NO,  
@SALTED_PASSWORD, 
@SALTED_PASSWORD,
@DEALER_CODE,
@LICNO1,
@LIC_NO          
)   

UPDATE SEEDLICDIST SET REFNO1 = @REF_NO,LICNO1 = @LICNO1,DELAER_CODE = @DEALER_CODE  WHERE LIC_NO = @LIC_NO



DECLARE cur1 CURSOR FOR     
SELECT APPNAME, APPADDRESS, APPDIST_ID, APPBLOCK_ID, APPPIN, APPEMAIL_ID, APPICARD_TYPE, APPCARD_NO, APPMOB_NO FROM SEEDLICAPPDIST WHERE LIC_NO = @LIC_NO
  
OPEN cur1    
  
FETCH NEXT FROM cur1     
INTO @APPNAME, @APPADDRESS, @APPDIST_ID, @APPBLOCK_ID, @APPPIN, @APPEMAIL_ID, @APPICARD_TYPE, @APPCARD_NO, @APPMOB_NO    
  
WHILE @@FETCH_STATUS = 0    
BEGIN

SET @SEED_LIC_DIST_ID = (SELECT SEED_LIC_DIST_ID FROM SEED_LIC_DIST WHERE LIC_NO1 = @LIC_NO)
set @APPBLOCK_ID = (SELECT block_code FROM block WHERE LGBLOCK_CODE = @APPBLOCK_ID)
SET @APPDIST_ID = @DIST_CODE;

INSERT INTO SEED_LIC_APP_DIST
(
SEED_LIC_DIST_ID, APPNAME, APPADDRESS, APPSTATE, APPDIST_ID, APPBLOCK_ID, APPPIN, APPEMAIL_ID, APPMOB_NO, APPICARD_TYPE, APPCARD_NO
)
VALUES
(
@SEED_LIC_DIST_ID, @APPNAME, @APPADDRESS, 'Odisha', @APPDIST_ID, @APPBLOCK_ID, @APPPIN, @APPEMAIL_ID, @APPMOB_NO, @APPICARD_TYPE, @APPCARD_NO
)

INSERT INTO SEED_LIC_BUS_DIST
(
SEED_LIC_DIST_ID, STATE, DIST_ID, BLOCK_ID, PIN
)
VALUES
(
@SEED_LIC_DIST_ID,'Odisha',@APPDIST_ID,@APPBLOCK_ID,@APPPIN
)

INSERT INTO SEED_LIC_BUS1_DIST
(
SEED_LIC_DIST_ID, STATE, DIST_ID, BLOCK_ID, PIN
)
VALUES
(
@SEED_LIC_DIST_ID,'Odisha',@APPDIST_ID,@APPBLOCK_ID,@APPPIN
)


FETCH NEXT FROM cur1     
INTO @APPNAME, @APPADDRESS, @APPDIST_ID, @APPBLOCK_ID, @APPPIN, @APPEMAIL_ID, @APPICARD_TYPE, @APPCARD_NO, @APPMOB_NO     
   
END     
CLOSE cur1;    
DEALLOCATE cur1; 

DECLARE cur2 CURSOR FOR     
SELECT COMP_NAME FROM SEEDLICCOMPDIST WHERE LIC_NO = @LIC_NO
  
OPEN cur2
  
FETCH NEXT FROM cur2     
INTO @COMP_NAME    
  
WHILE @@FETCH_STATUS = 0    
BEGIN

SET @SEED_LIC_DIST_ID = (SELECT SEED_LIC_DIST_ID FROM SEED_LIC_DIST WHERE LIC_NO1 = @LIC_NO)

IF(@COMP_NAME = 'OSSC')
BEGIN
SET @COMP_TYPE = 1;
END
ELSE 
BEGIN
SET @COMP_TYPE = 2;
END

INSERT INTO SEED_LIC_COMP_DIST
(
SEED_LIC_DIST_ID, COMP_TYPE, COMP_NAME
)
VALUES
(
@SEED_LIC_DIST_ID, @COMP_TYPE, @COMP_NAME
)


FETCH NEXT FROM cur2     
INTO @COMP_NAME     
   
END     
CLOSE cur2;    
DEALLOCATE cur2;
END
END

UPDATE SEEDLICDIST SET I_STATUS=1 WHERE LICNO1 = @LICNO1     --SLNO=7080

    FETCH NEXT FROM cur     
INTO @SLNO, @APP_FIRMNAME, @APP_TYPE, @APR_UPTO, @LIC_NO, @APPMOB_NO, @AADHAR_NO, @userId, @SALTED_PASSWORD, @DIST_CODE, @DIST_NAME, @DAO_CD, @DAO_NAME, @APR_DATE, @PHOTO,@LIC_TYPE, @REFNO1, @LICNO1     
   
END     
CLOSE cur;    
DEALLOCATE cur; 

--select @DIST_CODE,@mDIST_NAME,@DAO_CD
SELECT @REF_NO, @LIC_NO,@LICNO1, @DEALER_CODE